<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>NS7154 From Cell to Society - R Handbook - Session 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./day4.html" rel="next">
<link href="./day2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="styles/styles.css">
<link rel="stylesheet" href="include/webex.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./day3.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Session 3</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">NS7154 From Cell to Society - R Handbook</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Welcome!</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Why learn R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Why learn R?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Getting started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Session 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Session 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Session 3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">day 4</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">day 5</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-visulisation-with-ggplot" id="toc-data-visulisation-with-ggplot" class="nav-link active" data-scroll-target="#data-visulisation-with-ggplot">Data visulisation with ggplot</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#visualising-hypertention-scatter-plot" id="toc-visualising-hypertention-scatter-plot" class="nav-link" data-scroll-target="#visualising-hypertention-scatter-plot">Visualising hypertention (scatter plot)</a>
  <ul class="collapse">
  <li><a href="#wrangling-blood-pressure-data" id="toc-wrangling-blood-pressure-data" class="nav-link" data-scroll-target="#wrangling-blood-pressure-data">Wrangling blood pressure data</a></li>
  <li><a href="#plotting-blood-pressure-data" id="toc-plotting-blood-pressure-data" class="nav-link" data-scroll-target="#plotting-blood-pressure-data">Plotting blood pressure data</a></li>
  </ul></li>
  <li><a href="#visualising-wemwbs-by-simd-distribution-plots" id="toc-visualising-wemwbs-by-simd-distribution-plots" class="nav-link" data-scroll-target="#visualising-wemwbs-by-simd-distribution-plots">Visualising WEMWBS by SIMD (distribution plots)</a>
  <ul class="collapse">
  <li><a href="#wrangling-wemwbs-and-simd-data" id="toc-wrangling-wemwbs-and-simd-data" class="nav-link" data-scroll-target="#wrangling-wemwbs-and-simd-data">Wrangling WEMWBS and SIMD data</a></li>
  <li><a href="#visulising-distributions-by-catagorise-box-plots" id="toc-visulising-distributions-by-catagorise-box-plots" class="nav-link" data-scroll-target="#visulising-distributions-by-catagorise-box-plots">Visulising distributions by catagorise (box plots)</a></li>
  </ul></li>
  <li><a href="#take-home-exercises" id="toc-take-home-exercises" class="nav-link" data-scroll-target="#take-home-exercises">Take home exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-plot-weight-hight-and-bmi-catagories" id="toc-exercise-1-plot-weight-hight-and-bmi-catagories" class="nav-link" data-scroll-target="#exercise-1-plot-weight-hight-and-bmi-catagories">Exercise 1: Plot weight, hight and BMI catagories</a></li>
  <li><a href="#exercise-2-plot-map-by-age-catagories" id="toc-exercise-2-plot-map-by-age-catagories" class="nav-link" data-scroll-target="#exercise-2-plot-map-by-age-catagories">Exercise 2: Plot MAP by age catagories</a></li>
  </ul></li>
  <li><a href="#bonus-section-bbc-news-articles-use-ggplot" id="toc-bonus-section-bbc-news-articles-use-ggplot" class="nav-link" data-scroll-target="#bonus-section-bbc-news-articles-use-ggplot">Bonus section: BBC News articles use ggplot</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Session 3</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="data-visulisation-with-ggplot" class="level1">
<h1>Data visulisation with ggplot</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This week, I want to introduce you to the data visualisation package <code>ggplot2</code> (which is contained within the <code>tidyverse</code> package). <code>ggplot</code> is an incredibly versatile way of creating graphs and has become the standard throughout academic publishing, industry, and data journalism (see bonus section at end of page for more on this last use case).</p>
<p>As with previous sessions we will be using your assignment dataset and, seeing as it’s a new session, it’s a good idea to go though our new session checklist again.</p>
<p>Please go ahead and:</p>
<ol type="1">
<li>Close any old scripts, clean your environment window (the little broom button) and Restart R.</li>
<li>Create a new R script</li>
<li>Save that script to your working directory</li>
<li>Set your working directory</li>
<li>Check that you are in the right working directory <code>file.list()</code></li>
<li>Load the tidyverse package <code>library(tidyverse)</code></li>
<li>Read in your data using <code>read_csv()</code></li>
</ol>
</section>
<section id="visualising-hypertention-scatter-plot" class="level2">
<h2 class="anchored" data-anchor-id="visualising-hypertention-scatter-plot">Visualising hypertention (scatter plot)</h2>
<p>Hypertension is the chronic diagnostic label given to people with persistently high blood pressure. Someone with hypertension can be symptomless for years, but may be at increases the risk of heart disease, stroke, kidney disease and vascular dementia.</p>
<p>For most adults, readings are considered high if they’re 140/90 mmHg or higher in clinic, or 135/85 mmHg or higher at home (see <a href="https://en.wikipedia.org/wiki/White_coat_hypertension">white coat effect</a>). Diagnosis isn’t made on a single reading; it’s typically confirmed with 24-hour ambulatory monitoring or a series of home readings. Very high values (e.g., around 180/120 mmHg) warrant urgent clinical assessment.</p>
<p>In this session, we’ll use the simple clinic threshold of 140/90 mmHg to define a “hypertension” category. Then we’ll plot systolic and diastolic blood pressure to see what that diagnosis looks like in real terms.</p>
<section id="wrangling-blood-pressure-data" class="level3">
<h3 class="anchored" data-anchor-id="wrangling-blood-pressure-data">Wrangling blood pressure data</h3>
<p>Our first step is to tidy up our blood pressure variables in the same way as we did in the last session. See if you can identify and adapt the correct code and create the systolic and diastolic blood pressure variables. No need to worry about MAP for this part of the exercise.</p>
<p>Then we need to process the data using the <code>mutate()</code> with a <code>case_when()</code> function to turn the two continuous BP variables into a single categorical variable that tell us if the person is hypertensive or not.</p>
<p>As mentioned above, hypertension is to be defined as a systolic reading higher than <code>140</code> <strong>or</strong> a diastolic reading higher than <code>90</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, bp_sys_omron_r3_mmhg, bp_sys_omron_r4_mmhg,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>         bp_dia_omron_r3_mmhg, bp_dia_omron_r4_mmhg,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         bp_series_valid_code) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bp_series_valid_code <span class="sc">==</span> <span class="st">"Valid blood pressure measurement"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">systolic =</span> ((bp_sys_omron_r3_mmhg <span class="sc">+</span> bp_sys_omron_r4_mmhg)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">diastolic =</span> ((bp_dia_omron_r3_mmhg <span class="sc">+</span> bp_dia_omron_r4_mmhg)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bp_cat =</span> <span class="fu">case_when</span>(systolic <span class="sc">&gt;=</span> <span class="dv">140</span> <span class="sc">|</span> diastolic <span class="sc">&gt;=</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">"hypertensive"</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                            systolic <span class="sc">&lt;</span> <span class="dv">140</span> <span class="sc">|</span> diastolic <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">"not hypertensive"</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Due to there only being two categories another way to solve step to would be with an <code>if_else</code> statement.</p>
<div class="webex-solution">
<button>
if_else()
</button>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bp_cat =</span> <span class="fu">if_else</span>(systolic <span class="sc">&gt;=</span> <span class="dv">140</span> <span class="sc">&amp;</span> diastolic <span class="sc">&gt;=</span> <span class="dv">90</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"hypertensive"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"not hypertensive"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The first argument in <code>if_else()</code> outlines the parameters for <code>TRUE</code>, the second argument labels for <code>TRUE</code> the third labels for <code>FALSE</code></p>
</div>
</div>
</div>
</div>
<p>And final just to tidy up our dataset we can drop the variables that we don’t need.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, systolic, diastolic, bp_cat)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>bp_sys_omron_r3_mmhg, <span class="sc">-</span>bp_sys_omron_r4_mmhg, <span class="sc">-</span>bp_dia_omron_r3_mmhg,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>bp_dia_omron_r4_mmhg, <span class="sc">-</span>bp_series_valid_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-blood-pressure-data" class="level3">
<h3 class="anchored" data-anchor-id="plotting-blood-pressure-data">Plotting blood pressure data</h3>
<p>Creating a plot with <code>ggplot()</code> requires using a set of grammar that builds up your plot layer by layer. For now the easiest way to start a graph is to pick the dataset you want to use and <strong>pipe</strong> that into the ggplot function. Later on you may want to represent multiple datasets on the same plot, when doing so you’ll need a different grammar but for now most of your graphs will start like this:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Running the above you’ll see a blank canvas in the bottom right hand RStudio screen. This is where we’ll build our plot. Adjusting this screen will change the size of the graph, so keep it to around a quarter of your overall screen so that your graph is viable and of a reasonable aspect ratio.</p>
<p><img src="images/ggplot1.png" class="img-fluid"></p>
<p>Next, as the first argument within the <code>ggplot()</code> function we need to set out the <strong>aesthetic</strong>. This will tell R, which variables from our dataset will appear on our graph and where/how. To set the aesthetic we need to use the <code>aes()</code> function and then allocate a variable to the x-axis and a variable to the y-axis.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diastolic, <span class="at">y =</span> systolic))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Running the above sets the aesthetic so that we now have our <code>diastolic</code> variable set to the x-axis and our <code>systolic</code> variable set to the y-axis.</p>
<p><img src="images/ggplot2.png" class="img-fluid"></p>
<p>Next we need to add another layer to our plot. To do this we use a <code>+</code> and hit return so that the next layer starts on the following line (note: its <code>+</code> not <code>%&gt;%</code> when working on a <code>ggplot()</code>, but they both basically mean: <strong>and then</strong>)</p>
<p>And finally, to make the most basic version of a plot, we can layer on top a <strong>geometry</strong>, this is the type of graph that we would like to make. In this case we will use <code>geom_point()</code> which gives us the geometry of a scatter plot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diastolic, <span class="at">y =</span> systolic)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Running the above gives us a scatter plot where each point is an individual in our dataset located at the coordinates of their <code>diastolic</code> and <code>systolic</code> readings.</p>
<p><img src="images/ggplot3.png" class="img-fluid"></p>
<p>From here we can start adding to the graph to customise it. For the purposes of this graph it would be interesting to see which of our participants would get the hypertension diagnosis and which would not. We can achieve this by adding colour to our aesthetic and linking that colour to our <code>bp_cat</code> variable.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diastolic, <span class="at">y =</span> systolic, <span class="at">colour =</span> bp_cat)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From this we can now see the 140/90 cut off in action.</p>
<p><img src="images/ggplot4.png" class="img-fluid"></p>
<p>If I were working on this figure for publication or a talk there is a lot more tidying up that I would do. Here’s what I think is a fairly good looking graph.</p>
<p>Have a play around with the code. One of the best ways to learn how it works is to make changes and see what changes when you run the code.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diastolic, <span class="at">y =</span> systolic, <span class="at">colour =</span> bp_cat)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkred"</span>, <span class="st">"darkblue"</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Hypertensive"</span>, <span class="st">"Not Hypertensive"</span>)) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Diastolic (mmHg)"</span>, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Systolic (mmHg)"</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">""</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Figure 1"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Hypertension threshold at 140 / 90 mmHg"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Scottish Health Survey (2022)"</span>) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/ggplot5.png" class="img-fluid"></p>
<div class="webex-solution">
<button>
Don’t fear errors!
</button>
<p>Errors are a constant part of working in R, don’t let them put you off!</p>
<p>They do not mean that you are <em>bad at coding</em>!</p>
<p>I’m constantly hitting errors when I code. The only skill that matters is the ability to solve errors when you hit them. Here are some tips:</p>
<ol type="1">
<li>Reload you packages. Especially if the error is something like this:</li>
</ol>
<p><img src="images/error1.png" class="img-fluid"></p>
<ol start="2" type="1">
<li>Take a look at the bar to the left of your script, it will often tell you the line where the error happen. That can help you spot where you went wrong. Reading through those lines may help you spot a missing <code>,</code>, <code>%&gt;%</code> or as in this case a <code>+</code>. <img src="images/error2.png" class="img-fluid"></li>
<li>Read the error, if you’re really lucky it will tell you what mistake you’ve made. For instance here it suggests a <code>==</code> instead of a <code>=</code>, a very common issue when using <code>filter()</code>.</li>
</ol>
<p><img src="images/error3.png" class="img-fluid"></p>
<ol start="4" type="1">
<li>Finally, when you really cannot work out what’s going wrong, throw the code and the error into an AI. It’ll likely be able to spot where you’ve gone wrong.</li>
</ol>
<p>For more on working with the AI to solve errors I recommend taking a look at the <a href="https://psyteachr.github.io/AITutoR/04-errors.html">University of Glasgow PsyTeachR resources</a></p>
</div>
</section>
</section>
<section id="visualising-wemwbs-by-simd-distribution-plots" class="level2">
<h2 class="anchored" data-anchor-id="visualising-wemwbs-by-simd-distribution-plots">Visualising WEMWBS by SIMD (distribution plots)</h2>
<p>With the blood-pressure scatter plot we explored a relationship between two continuous variables and overlaid a clinical threshold. Next, we’ll look at the shape of a single variable and how that shape differs across groups. To do that, we’ll switch to WEMWBS and compare distributions by levels of deprivation (SIMD). A histogram shows the overall shape (skew, peaks, gaps); a box plot summarises medians and spread for quick comparison. Same tidy grammar, new geoms moving us from <em>are two measures related?</em> to <em>how does wellbeing vary by context?</em>.</p>
<p><strong>WEMWBS (Warwick–Edinburgh Mental Wellbeing Scale).</strong> A 14-item scale that assesses mental wellbeing focusing on positive feelings and functioning; items are rated on a 5-point scale and summed to a total score (commonly 14–70). Further information and materials are available from the <a href="https://warwick.ac.uk/services/innovations/wemwbs/">University of Warwick</a>.</p>
<p><strong>SIMD (Scottish Index of Multiple Deprivation).</strong> Scotland’s official tool for identifying relative deprivation of small areas (“data zones”), combining seven domains: income, employment, education, health, access to services, crime, and housing. See the <a href="https://www.gov.scot/collections/scottish-index-of-multiple-deprivation-2020/">Scottish Government’s SIMD</a> pages for details and data.</p>
<section id="wrangling-wemwbs-and-simd-data" class="level3">
<h3 class="anchored" data-anchor-id="wrangling-wemwbs-and-simd-data">Wrangling WEMWBS and SIMD data</h3>
<p>If you completed the exercises for session 1 you have already done the majority of the wrangling here. The WEMWBS has 14 items to it. To turn the 14 items into a wellbeing score (where higher is greater wellbeing) all we need to do is add the items together.</p>
<p>In the exercise in session 1 I suggested you to select them out into a new data object, but really this is an unnecessary step. We can just do all of our cleaning in our original dataset and draw directly from there if we want.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>shes_2022_data <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wemwbs_score =</span> wemwbs_optimistic <span class="sc">+</span> wemwbs_useful <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>           wemwbs_relaxed <span class="sc">+</span> wemwbs_interested_in_people <span class="sc">+</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>           wemwbs_energy <span class="sc">+</span> wemwbs_dealing_problems <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>           wemwbs_thinking_clearly <span class="sc">+</span> wemwbs_good_about_self <span class="sc">+</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>           wemwbs_close_to_others <span class="sc">+</span> wemwbs_confident <span class="sc">+</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>           wemwbs_make_up_mind <span class="sc">+</span> wemwbs_loved <span class="sc">+</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>           wemwbs_interested_in_new_things <span class="sc">+</span> wemwbs_cheerful)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And just to keep it all easy for you to see whats going on, we’ll pull the reliant variables for this section over into a separate data object.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wemwbs_score, simd20_quintile)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wemebs_simd_data) <span class="co"># just to see what we're working with</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In session 1 we ran a quick and dirty histogram using the <code>hist()</code> function:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(wemebs_simd_data<span class="sc">$</span>wemwbs_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/hist_dirty.png" class="img-fluid"> This is fine for a brief look at the data but to get something a little more customisable we can reproduce the same graph using <code>ggplot()</code>.</p>
<p>As with the scatter plot this requires us setting the <code>aes()</code>, layering on the appropriate <code>geom_</code> and then customising the arguments to our liking.</p>
<p>Here is a basic version:</p>
<p><img src="images/hist_gg_1.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code for plot
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note only x-axis is needed in aes, as y-axis is a count of x</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wemwbs_score)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>Not yet as clear as the <code>hist()</code> but with a bit of customising it can look quite nice:</p>
<p><img src="images/hist_gg_2.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code for plot
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wemwbs_score)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#005A9C"</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"????"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"????"</span>) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>Take the code for the above graph and see if you can:</p>
<ol type="1">
<li>work out what the <code>binwidth</code> argument controls</li>
<li>try taking out <code>binwidth</code>, exchange for <code>bins</code> and see if you can work out what the <code>bins</code> argument controls</li>
<li>work out what the <code>scale_x_continuous()</code> function controls and why I’ve set it to this</li>
<li>give the figure a suitable title and x-axis label</li>
<li>change the colour to anything you’d like. Here is a website to help you: <a href="https://htmlcolorcodes.com/">Colour picker</a></li>
<li>change the theme</li>
</ol>
</section>
<section id="visulising-distributions-by-catagorise-box-plots" class="level3">
<h3 class="anchored" data-anchor-id="visulising-distributions-by-catagorise-box-plots">Visulising distributions by catagorise (box plots)</h3>
<p>There are a number of ways that we could visualise how wellbeing (WEMEBS) differs across levels of deprivation (SIMD). Personaly, I like a box plot with a violin plot to demonstrate the distribution.</p>
<p>The following code puts puts the continuous wellbeing variable on the x-axis and the five quintiles of deprevation on the y-axis. It then layer up two geometries: a <code>geom_violin()</code> and a <code>geom_boxplot()</code>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>wemwbs_score, <span class="at">y =</span> simd20_quintile))<span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It also creates one of the ugliest graph I’ve ever seen.</p>
<div class="webex-solution">
<button>
Click for ugly graph
</button>
<p><img src="images/boxplot_ugly.png" class="img-fluid"></p>
<p>Yuck! I’m sorry you had to see that.</p>
</div>
<p>So, let’s tart it up a bit.</p>
<p>Much better:</p>
<p><img src="images/boxplot_nice.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code for plot
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Some new arguments in here. As before play around with them and see what they change.</p>
<p>Note how I defined the colours in one expression and then just used the assigned <code>colours</code> in the <code>ggplot()</code>. This can save space and make things more efficient if you have multiple graphs with the same colour scheme.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Most deprived (Q1)"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Q2"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Q3"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Q4"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"least deprived (Q5)"</span> <span class="ot">=</span> <span class="st">"#CC79A7"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wemwbs_score, <span class="at">y =</span> simd20_quintile)) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">fill =</span> simd20_quintile),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.9</span>, <span class="at">orientation =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.4</span>, <span class="at">orientation =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Most deprived (Q1)"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>, <span class="st">"least deprived (Q5)"</span>)) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colours)<span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of WEMWBS Scores Across Deprivation Quintiles"</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"SIMD Quintile"</span>, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"WEMWBS total"</span>) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="take-home-exercises" class="level2">
<h2 class="anchored" data-anchor-id="take-home-exercises">Take home exercises</h2>
<section id="exercise-1-plot-weight-hight-and-bmi-catagories" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1-plot-weight-hight-and-bmi-catagories">Exercise 1: Plot weight, hight and BMI catagories</h3>
<p>First exercise for this session is to adapt the blood pressure scatter plot above to create a scatter plot that demonstrates the catagories of BMI as they relate to height and weight.</p>
<p>For this exercise you will need to:</p>
<ul>
<li>create a date object that includes height and weight</li>
<li>calculate BMI (see session 1)</li>
<li>create the categorical variables associated with BMI (see session 2)</li>
<li>create a scatter of weight and height, with each point coloured by BMI catagories.</li>
<li>adapt the plot to make it look pretty</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Lots of ways you could do this, here’s how I tackled it:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>shes_2022_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"SHeS_2022_clean.csv"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create continuious BMI variable  </span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, height_cm_self_adj, weight_kg_self_adj) <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi =</span> weight_kg_self_adj <span class="sc">/</span> ((height_cm_self_adj <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># create BMI catagorical variables</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="ot">&lt;-</span> shes_BMI <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi_band =</span> <span class="fu">case_when</span>(bmi <span class="sc">&lt;</span> <span class="fl">18.5</span> <span class="sc">~</span> <span class="st">"underweight"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                              bmi <span class="sc">&gt;=</span> <span class="fl">18.5</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;</span> <span class="dv">25</span>  <span class="sc">~</span> <span class="st">"healthy range"</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>                              bmi <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"overweight"</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                              bmi <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"obesity"</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                              bmi <span class="sc">&gt;=</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"severe obesity"</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>))</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># basic plot</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="sc">%&gt;%</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_kg_self_adj, </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> height_cm_self_adj, </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> bmi_band)) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/bmi scatter plot basic.png" class="img-fluid"></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fancy plot</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"underweight"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"healthy range"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"overweight"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"obesity"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"severe obesity"</span> <span class="ot">=</span> <span class="st">"#CC79A7"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># this reorders the catagories, to make the legend order correct</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># we'll be doing this more next week for logictic regression</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="ot">&lt;-</span> shes_BMI <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bmi_band)) <span class="sc">%&gt;%</span> <span class="co"># this line removed the NAs</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi_band =</span> <span class="fu">factor</span>(bmi_band,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"underweight"</span>, <span class="st">"healthy range"</span>, </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"overweight"</span>, <span class="st">"obesity"</span>, </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"severe obesity"</span>)))</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_kg_self_adj, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> height_cm_self_adj, </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> bmi_band)) <span class="sc">+</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> colours,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"BMI Category"</span>) <span class="sc">+</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Weight (kg)"</span>, </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Height (cm)"</span>, </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Height and Weight by BMI Category"</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Scottish Health Survey (2022)"</span>) <span class="sc">+</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/bmi scatter plot pretty.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
<section id="exercise-2-plot-map-by-age-catagories" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2-plot-map-by-age-catagories">Exercise 2: Plot MAP by age catagories</h3>
<p>For this exercise I’d like you to create a box an violin plot that shows Mean Arterial Pressure (MAP) broken down by age categories.</p>
<p>To create this plot you will need to:</p>
<ul>
<li>create a data object with the blood pressure data and the age variable</li>
<li>calculate a MAP variable (see session 2)</li>
<li>create a categorical age variable (see session 2)</li>
<li>create a basic box plot by adapting the above wellbeing/SIMD code</li>
<li>tart it up a bit to make it all pretty</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>shes_2022_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"SHeS_2022_clean.csv"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># this code selects the data</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>shes_bp_age <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, age, bp_sys_omron_r3_mmhg, bp_sys_omron_r4_mmhg,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>         bp_dia_omron_r3_mmhg, bp_dia_omron_r4_mmhg,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>         bp_series_valid_code)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># this code filters to include only valid measurements</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="ot">&lt;-</span> shes_bp_age <span class="sc">%&gt;%</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bp_series_valid_code <span class="sc">==</span> <span class="st">"Valid blood pressure measurement"</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># this code takes an average of the sys and dia readings</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="ot">&lt;-</span> shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">systolic =</span> ((bp_sys_omron_r3_mmhg <span class="sc">+</span> bp_sys_omron_r4_mmhg)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">diastolic =</span> ((bp_dia_omron_r3_mmhg <span class="sc">+</span> bp_dia_omron_r4_mmhg)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># this code calculates Mean Arterial Pressure ()</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="ot">&lt;-</span> shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">map =</span> (systolic <span class="sc">+</span> (<span class="dv">2</span> <span class="sc">*</span> diastolic)) <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># this code creates the age bands</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="ot">&lt;-</span> shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_band =</span> <span class="fu">case_when</span>(age <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"18–29"</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>                              age <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">45</span>  <span class="sc">~</span> <span class="st">"30–44"</span>,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                              age <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">65</span>  <span class="sc">~</span> <span class="st">"45–64"</span>,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>                              age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">"65+"</span>,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>))</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># basic box and violin plot code</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> map, <span class="at">y =</span> age_band)) <span class="sc">+</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/map box plot basic.png" class="img-fluid"></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pretty graph code</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"65+"</span> <span class="ot">=</span> <span class="st">"darkred"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"45–64"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"30–44"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"18–29"</span> <span class="ot">=</span> <span class="st">"salmon"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> map, <span class="at">y =</span> age_band)) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">fill =</span> age_band),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">width =</span> <span class="fl">0.9</span>, <span class="at">orientation =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.4</span>, <span class="at">orientation =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">180</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colours)<span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of MAP Scores across Age"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Age Bands"</span>, </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Mean Arterial Pressure (MAP)"</span>) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/map box plot pretty.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
</section>
<section id="bonus-section-bbc-news-articles-use-ggplot" class="level2">
<h2 class="anchored" data-anchor-id="bonus-section-bbc-news-articles-use-ggplot">Bonus section: BBC News articles use ggplot</h2>
<p>Well done, you now have the skills to make publication quality figures.</p>
<p>I’m a little obsessed with data visualisation. Much of my work looks at how the public understands big societal and scientific issues such as climate change, the cost of living, and pandemics. These issues require people to update their knowledge about complex topics, and a well-designed visualisation is often essential to make information clear and accessible.</p>
<p>I’m a big fan of the work of the FT data journalist John Burn-Murdoch:</p>
<p><img src="images/JBM graphs.png" class="img-fluid"></p>
<p><a href="https://cloud.rstudio.com/authors/john-burn-murdoch/">All made with R and ggplot</a></p>
<p>And he, and the FT, are not the only journalists using <code>ggplot()</code>. The BBC adopted ggplot a few years ago, here is their <em>cookbook</em> where they outline their process: <a href="https://bbc.github.io/rcookbook/">BBC Visual and Data Journalism cookbook for R graphics</a></p>
<p>This is so comprehensive that it’s possible to <strong>read a BBC article</strong>, <strong>see a graph</strong>, and the go out <strong>and recreate</strong>.</p>
<p>So that’s what I decided to do!</p>
<p>Here is the article: <a href="https://www.bbc.co.uk/news/articles/cn4l927dj5zo">Three years left to limit warming to 1.5C, leading scientists warn</a></p>
<p>Here is their plot:</p>
<p><img src="images/BBC plot original.png" class="img-fluid"></p>
<p>And here is my attempt at recreating it:</p>
<p><img src="images/BBC plot my version.png" class="img-fluid"></p>
<p>They had the up-to-date data that pushed the line over 1.5C (hense news!) and there were a few bits I couldn’t recreate. But still, pretty close, right! I’d be great at creating misinformation if I wanted to!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code for plot
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Here is the code, though it wont run unless you have the associated datasets.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbplot)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>annual <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"annual_averages.csv"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>decadal <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"decadal_averages.csv"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>subtitle_text <span class="ot">&lt;-</span> <span class="st">"Global air temperature compared with pre-industraial &lt;br&gt; (1850-1900) levels &lt;span style='color:salmon;'&gt;yearly average&lt;/span&gt; and &lt;span style='color:darkred;'&gt;10-year average&lt;/span&gt;."</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> annual, </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>GMST), </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"salmon"</span>, </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.15</span>)<span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> decadal, </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>GMST), </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"darkred"</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.15</span>)<span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"How the planet's temperature has risen"</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> subtitle_text,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"GDP per Capita (log scale recommended)"</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Life Expectancy (Years)"</span>) <span class="sc">+</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>),</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"-0.5°C"</span>, </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"pre-</span><span class="sc">\n</span><span class="st">industrial</span><span class="sc">\n</span><span class="st"> average"</span>, </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"+0.5°C"</span>,</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"+1.0°C"</span>,</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"+1.5°C"</span>))<span class="sc">+</span> </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bbc_style</span>()<span class="sc">+</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">28</span>),</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">22</span>),</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>),</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>))</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="fu">finalise_plot</span>(<span class="at">plot_name =</span> plot2,</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">source =</span> <span class="st">"Source: Forster et al.(2025), Earth System Science Data"</span>,</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">save_filepath =</span> <span class="st">"three years left.png"</span>,</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>              <span class="at">width_pixels =</span> <span class="dv">640</span>,</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">height_pixels =</span> <span class="dv">450</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<div class="custom-footer">
  <p style="text-align:center; font-size:0.9rem; opacity:0.8;">
    NS7154 Handbook by Dr Richard Clarke - University of Gloucestershire - 
    <a href="mailto:rclarke8@glos.ac.uk">rclarke8@glos.ac.uk</a>
  </p>
</div>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./day2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Session 2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./day4.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">day 4</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb21" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Session 3"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> false   # no chapter/section numbers on this page</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> TRUE               # (optional) hide the on-page TOC</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/global-setup.R"</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data visulisation with ggplot</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>This week, I want to introduce you to the data visualisation package <span class="in">`ggplot2`</span> (which is contained within the <span class="in">`tidyverse`</span> package). <span class="in">`ggplot`</span> is an incredibly versatile way of creating graphs and has become the standard throughout academic publishing, industry, and data journalism (see bonus section at end of page for more on this last use case).</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>As with previous sessions we will be using your assignment dataset and, seeing as it's a new session, it's a good idea to go though our new session checklist again.</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>Please go ahead and:</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Close any old scripts, clean your environment window (the little broom button) and Restart R.</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Create a new R script</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Save that script to your working directory</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Set your working directory</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Check that you are in the right working directory <span class="in">`file.list()`</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Load the tidyverse package <span class="in">`library(tidyverse)`</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Read in your data using <span class="in">`read_csv()`</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualising hypertention (scatter plot)</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>Hypertension is the chronic diagnostic label given to people with persistently high blood pressure. Someone with hypertension can be symptomless for years, but may be at increases the risk of heart disease, stroke, kidney disease and vascular dementia. </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>For most adults, readings are considered high if they’re 140/90 mmHg or higher in clinic, or 135/85 mmHg or higher at home (see <span class="co">[</span><span class="ot">white coat effect</span><span class="co">](https://en.wikipedia.org/wiki/White_coat_hypertension)</span>). Diagnosis isn’t made on a single reading; it’s typically confirmed with 24-hour ambulatory monitoring or a series of home readings. Very high values (e.g., around 180/120 mmHg) warrant urgent clinical assessment.</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>In this session, we’ll use the simple clinic threshold of 140/90 mmHg to define a “hypertension” category. Then we'll plot systolic and diastolic blood pressure to see what that diagnosis looks like in real terms.  </span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrangling blood pressure data</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>Our first step is to tidy up our blood pressure variables in the same way as we did in the last session. See if you can identify and adapt the correct code and create the systolic and diastolic blood pressure variables. No need to worry about MAP for this part of the exercise.</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>Then we need to process the data using the <span class="in">`mutate()`</span> with a <span class="in">`case_when()`</span> function to turn the two continuous BP variables into a single categorical variable that tell us if the person is hypertensive or not.</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>As mentioned above, hypertension is to be defined as a systolic reading higher than <span class="in">`140`</span> **or** a diastolic reading higher than <span class="in">`90`</span>. </span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="fu">### Solution</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, bp_sys_omron_r3_mmhg, bp_sys_omron_r4_mmhg,</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>         bp_dia_omron_r3_mmhg, bp_dia_omron_r4_mmhg,</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>         bp_series_valid_code) <span class="sc">%&gt;%</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bp_series_valid_code <span class="sc">==</span> <span class="st">"Valid blood pressure measurement"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">systolic =</span> ((bp_sys_omron_r3_mmhg <span class="sc">+</span> bp_sys_omron_r4_mmhg)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">diastolic =</span> ((bp_dia_omron_r3_mmhg <span class="sc">+</span> bp_dia_omron_r4_mmhg)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bp_cat =</span> <span class="fu">case_when</span>(systolic <span class="sc">&gt;=</span> <span class="dv">140</span> <span class="sc">|</span> diastolic <span class="sc">&gt;=</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">"hypertensive"</span>,</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>                            systolic <span class="sc">&lt;</span> <span class="dv">140</span> <span class="sc">|</span> diastolic <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">"not hypertensive"</span>,</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>))</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>Due to there only being two categories another way to solve step to would be with an <span class="in">`if_else`</span> statement.</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="in">`r webexercises::hide("if_else()")`</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bp_cat =</span> <span class="fu">if_else</span>(systolic <span class="sc">&gt;=</span> <span class="dv">140</span> <span class="sc">&amp;</span> diastolic <span class="sc">&gt;=</span> <span class="dv">90</span>, </span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"hypertensive"</span>,</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"not hypertensive"</span>))</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>The first argument in <span class="in">`if_else()`</span> outlines the parameters for <span class="in">`TRUE`</span>, the second argument labels for <span class="in">`TRUE`</span> the third labels for <span class="in">`FALSE`</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a><span class="in">`r webexercises::unhide()`</span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>And final just to tidy up our dataset we can drop the variables that we don't need.</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, systolic, diastolic, bp_cat)</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="ot">&lt;-</span> shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>bp_sys_omron_r3_mmhg, <span class="sc">-</span>bp_sys_omron_r4_mmhg, <span class="sc">-</span>bp_dia_omron_r3_mmhg,</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>bp_dia_omron_r4_mmhg, <span class="sc">-</span>bp_series_valid_code)</span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plotting blood pressure data</span></span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>Creating a plot with <span class="in">`ggplot()`</span> requires using a set of grammar that builds up your plot layer by layer. For now the easiest way to start a graph is to pick the dataset you want to use and **pipe** that into the ggplot function. Later on you may want to represent multiple datasets on the same plot, when doing so you'll need a different grammar but for now most of your graphs will start like this:</span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>Running the above you'll see a blank canvas in the bottom right hand RStudio screen. This is where we'll build our plot. Adjusting this screen will change the size of the graph, so keep it to around a quarter of your overall screen so that your graph is viable and of a reasonable aspect ratio.  </span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/ggplot1.png)</span> </span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>Next, as the first argument within the <span class="in">`ggplot()`</span> function we need to set out the **aesthetic**. This will tell R, which variables from our dataset will appear on our graph and where/how. To set the aesthetic we need to use the <span class="in">`aes()`</span> function and then allocate a variable to the x-axis and a variable to the y-axis.    </span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,eval=FALSE}</span></span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diastolic, <span class="at">y =</span> systolic))</span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>Running the above sets the aesthetic so that we now have our <span class="in">`diastolic`</span> variable set to the x-axis and our <span class="in">`systolic`</span> variable set to the y-axis. </span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/ggplot2.png)</span> </span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>Next we need to add another layer to our plot. To do this we use a <span class="in">`+`</span> and hit return so that the next layer starts on the following line (note: its <span class="in">`+`</span> not <span class="in">`%&gt;%`</span> when working on a <span class="in">`ggplot()`</span>, but they both basically mean: **and then**) </span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a>And finally, to make the most basic version of a plot, we can layer on top a **geometry**, this is the type of graph that we would like to make. In this case we will use <span class="in">`geom_point()`</span> which gives us the geometry of a scatter plot.  </span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,eval=FALSE}</span></span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diastolic, <span class="at">y =</span> systolic)) <span class="sc">+</span></span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a>Running the above gives us a scatter plot where each point is an individual in our dataset located at the coordinates of their <span class="in">`diastolic`</span> and <span class="in">`systolic`</span> readings. </span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/ggplot3.png)</span> </span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a>From here we can start adding to the graph to customise it. For the purposes of this graph it would be interesting to see which of our participants would get the hypertension diagnosis and which would not. We can achieve this by adding colour to our aesthetic and linking that colour to our <span class="in">`bp_cat`</span> variable.   </span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diastolic, <span class="at">y =</span> systolic, <span class="at">colour =</span> bp_cat)) <span class="sc">+</span></span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb21-147"><a href="#cb21-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-148"><a href="#cb21-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-149"><a href="#cb21-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-150"><a href="#cb21-150" aria-hidden="true" tabindex="-1"></a>From this we can now see the 140/90 cut off in action. </span>
<span id="cb21-151"><a href="#cb21-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-152"><a href="#cb21-152" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/ggplot4.png)</span> </span>
<span id="cb21-153"><a href="#cb21-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-154"><a href="#cb21-154" aria-hidden="true" tabindex="-1"></a>If I were working on this figure for publication or a talk there is a lot more tidying up that I would do. Here's what I think is a fairly good looking graph. </span>
<span id="cb21-155"><a href="#cb21-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-156"><a href="#cb21-156" aria-hidden="true" tabindex="-1"></a>Have a play around with the code. One of the best ways to learn how it works is to make changes and see what changes when you run the code. </span>
<span id="cb21-157"><a href="#cb21-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-158"><a href="#cb21-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-159"><a href="#cb21-159" aria-hidden="true" tabindex="-1"></a>shes_bp <span class="sc">%&gt;%</span></span>
<span id="cb21-160"><a href="#cb21-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diastolic, <span class="at">y =</span> systolic, <span class="at">colour =</span> bp_cat)) <span class="sc">+</span></span>
<span id="cb21-161"><a href="#cb21-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb21-162"><a href="#cb21-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkred"</span>, <span class="st">"darkblue"</span>),</span>
<span id="cb21-163"><a href="#cb21-163" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Hypertensive"</span>, <span class="st">"Not Hypertensive"</span>)) <span class="sc">+</span></span>
<span id="cb21-164"><a href="#cb21-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Diastolic (mmHg)"</span>, </span>
<span id="cb21-165"><a href="#cb21-165" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Systolic (mmHg)"</span>, </span>
<span id="cb21-166"><a href="#cb21-166" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">""</span>,</span>
<span id="cb21-167"><a href="#cb21-167" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Figure 1"</span>,</span>
<span id="cb21-168"><a href="#cb21-168" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Hypertension threshold at 140 / 90 mmHg"</span>,</span>
<span id="cb21-169"><a href="#cb21-169" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Scottish Health Survey (2022)"</span>) <span class="sc">+</span></span>
<span id="cb21-170"><a href="#cb21-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb21-171"><a href="#cb21-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb21-172"><a href="#cb21-172" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb21-173"><a href="#cb21-173" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>),</span>
<span id="cb21-174"><a href="#cb21-174" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb21-175"><a href="#cb21-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-176"><a href="#cb21-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-177"><a href="#cb21-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-178"><a href="#cb21-178" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/ggplot5.png)</span> </span>
<span id="cb21-179"><a href="#cb21-179" aria-hidden="true" tabindex="-1"></a><span class="in">`r webexercises::hide("Don't fear errors!")`</span></span>
<span id="cb21-180"><a href="#cb21-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-181"><a href="#cb21-181" aria-hidden="true" tabindex="-1"></a>Errors are a constant part of working in R, don't let them put you off!</span>
<span id="cb21-182"><a href="#cb21-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-183"><a href="#cb21-183" aria-hidden="true" tabindex="-1"></a>They do not mean that you are *bad at coding*! </span>
<span id="cb21-184"><a href="#cb21-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-185"><a href="#cb21-185" aria-hidden="true" tabindex="-1"></a>I'm constantly hitting errors when I code. The only skill that matters is the ability to solve errors when you hit them. Here are some tips:</span>
<span id="cb21-186"><a href="#cb21-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-187"><a href="#cb21-187" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Reload you packages. Especially if the error is something like this:</span>
<span id="cb21-188"><a href="#cb21-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-189"><a href="#cb21-189" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/error1.png)</span> </span>
<span id="cb21-190"><a href="#cb21-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-191"><a href="#cb21-191" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Take a look at the bar to the left of your script, it will often tell you the line where the error happen. That can help you spot where you went wrong. Reading through those lines may help you spot a missing <span class="in">`,`</span>, <span class="in">`%&gt;%`</span> or as in this case a <span class="in">`+`</span>. </span>
<span id="cb21-192"><a href="#cb21-192" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/error2.png)</span> </span>
<span id="cb21-193"><a href="#cb21-193" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Read the error, if you're really lucky it will tell you what mistake you've made. For instance here it suggests a <span class="in">`==`</span> instead of a <span class="in">`=`</span>, a very common issue when using <span class="in">`filter()`</span>. </span>
<span id="cb21-194"><a href="#cb21-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-195"><a href="#cb21-195" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/error3.png)</span> </span>
<span id="cb21-196"><a href="#cb21-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-197"><a href="#cb21-197" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Finally, when you really cannot work out what's going wrong, throw the code and the error into an AI. It'll likely be able to spot where you've gone wrong. </span>
<span id="cb21-198"><a href="#cb21-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-199"><a href="#cb21-199" aria-hidden="true" tabindex="-1"></a>For more on working with the AI to solve errors I recommend taking a look at the <span class="co">[</span><span class="ot">University of Glasgow PsyTeachR resources</span><span class="co">](https://psyteachr.github.io/AITutoR/04-errors.html)</span></span>
<span id="cb21-200"><a href="#cb21-200" aria-hidden="true" tabindex="-1"></a><span class="in">`r unhide()`</span></span>
<span id="cb21-201"><a href="#cb21-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-202"><a href="#cb21-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualising WEMWBS by SIMD (distribution plots)</span></span>
<span id="cb21-203"><a href="#cb21-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-204"><a href="#cb21-204" aria-hidden="true" tabindex="-1"></a>With the blood-pressure scatter plot we explored a relationship between two continuous variables and overlaid a clinical threshold. Next, we’ll look at the shape of a single variable and how that shape differs across groups. To do that, we’ll switch to WEMWBS and compare distributions by levels of deprivation (SIMD). A histogram shows the overall shape (skew, peaks, gaps); a box plot summarises medians and spread for quick comparison. Same tidy grammar, new geoms moving us from *are two measures related?* to *how does wellbeing vary by context?*.</span>
<span id="cb21-205"><a href="#cb21-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-206"><a href="#cb21-206" aria-hidden="true" tabindex="-1"></a>**WEMWBS (Warwick–Edinburgh Mental Wellbeing Scale).**</span>
<span id="cb21-207"><a href="#cb21-207" aria-hidden="true" tabindex="-1"></a>A 14-item scale that assesses mental wellbeing focusing on positive feelings and functioning; items are rated on a 5-point scale and summed to a total score (commonly 14–70). Further information and materials are available from the <span class="co">[</span><span class="ot">University of Warwick</span><span class="co">](https://warwick.ac.uk/services/innovations/wemwbs/)</span>.</span>
<span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a>**SIMD (Scottish Index of Multiple Deprivation).**</span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a>Scotland’s official tool for identifying relative deprivation of small areas (“data zones”), combining seven domains: income, employment, education, health, access to services, crime, and housing. See the <span class="co">[</span><span class="ot">Scottish Government’s SIMD</span><span class="co">](https://www.gov.scot/collections/scottish-index-of-multiple-deprivation-2020/)</span> pages for details and data.</span>
<span id="cb21-211"><a href="#cb21-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-212"><a href="#cb21-212" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrangling WEMWBS and SIMD data</span></span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a>If you completed the exercises for session 1 you have already done the majority of the wrangling here. The WEMWBS has 14 items to it. To turn the 14 items into a wellbeing score (where higher is greater wellbeing) all we need to do is add the items together. </span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a>In the exercise in session 1 I suggested you to select them out into a new data object, but really this is an unnecessary step. We can just do all of our cleaning in our original dataset and draw directly from there if we want. </span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a>shes_2022_data <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wemwbs_score =</span> wemwbs_optimistic <span class="sc">+</span> wemwbs_useful <span class="sc">+</span> </span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a>           wemwbs_relaxed <span class="sc">+</span> wemwbs_interested_in_people <span class="sc">+</span> </span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a>           wemwbs_energy <span class="sc">+</span> wemwbs_dealing_problems <span class="sc">+</span></span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a>           wemwbs_thinking_clearly <span class="sc">+</span> wemwbs_good_about_self <span class="sc">+</span> </span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a>           wemwbs_close_to_others <span class="sc">+</span> wemwbs_confident <span class="sc">+</span> </span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a>           wemwbs_make_up_mind <span class="sc">+</span> wemwbs_loved <span class="sc">+</span> </span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a>           wemwbs_interested_in_new_things <span class="sc">+</span> wemwbs_cheerful)</span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a>And just to keep it all easy for you to see whats going on, we'll pull the reliant variables for this section over into a separate data object.</span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wemwbs_score, simd20_quintile)</span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wemebs_simd_data) <span class="co"># just to see what we're working with</span></span>
<span id="cb21-236"><a href="#cb21-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-237"><a href="#cb21-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a>In session 1 we ran a quick and dirty histogram using the <span class="in">`hist()`</span> function:</span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(wemebs_simd_data<span class="sc">$</span>wemwbs_score)</span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/hist_dirty.png)</span> </span>
<span id="cb21-245"><a href="#cb21-245" aria-hidden="true" tabindex="-1"></a>This is fine for a brief look at the data but to get something a little more customisable we can reproduce the same graph using <span class="in">`ggplot()`</span>. </span>
<span id="cb21-246"><a href="#cb21-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-247"><a href="#cb21-247" aria-hidden="true" tabindex="-1"></a>As with the scatter plot this requires us setting the <span class="in">`aes()`</span>, layering on the appropriate <span class="in">`geom_`</span> and then customising the arguments to our liking. </span>
<span id="cb21-248"><a href="#cb21-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-249"><a href="#cb21-249" aria-hidden="true" tabindex="-1"></a>Here is a basic version:</span>
<span id="cb21-250"><a href="#cb21-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-251"><a href="#cb21-251" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/hist_gg_1.png)</span> </span>
<span id="cb21-252"><a href="#cb21-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-253"><a href="#cb21-253" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb21-254"><a href="#cb21-254" aria-hidden="true" tabindex="-1"></a><span class="fu">### Code for plot</span></span>
<span id="cb21-255"><a href="#cb21-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-256"><a href="#cb21-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-257"><a href="#cb21-257" aria-hidden="true" tabindex="-1"></a><span class="co"># note only x-axis is needed in aes, as y-axis is a count of x</span></span>
<span id="cb21-258"><a href="#cb21-258" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="sc">%&gt;%</span></span>
<span id="cb21-259"><a href="#cb21-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wemwbs_score)) <span class="sc">+</span></span>
<span id="cb21-260"><a href="#cb21-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb21-261"><a href="#cb21-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-262"><a href="#cb21-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-263"><a href="#cb21-263" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-264"><a href="#cb21-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-265"><a href="#cb21-265" aria-hidden="true" tabindex="-1"></a>Not yet as clear as the <span class="in">`hist()`</span> but with a bit of customising it can look quite nice:</span>
<span id="cb21-266"><a href="#cb21-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-267"><a href="#cb21-267" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/hist_gg_2.png)</span></span>
<span id="cb21-268"><a href="#cb21-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-269"><a href="#cb21-269" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb21-270"><a href="#cb21-270" aria-hidden="true" tabindex="-1"></a><span class="fu">### Code for plot</span></span>
<span id="cb21-271"><a href="#cb21-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-272"><a href="#cb21-272" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-273"><a href="#cb21-273" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="sc">%&gt;%</span></span>
<span id="cb21-274"><a href="#cb21-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wemwbs_score)) <span class="sc">+</span></span>
<span id="cb21-275"><a href="#cb21-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#005A9C"</span>) <span class="sc">+</span></span>
<span id="cb21-276"><a href="#cb21-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb21-277"><a href="#cb21-277" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-278"><a href="#cb21-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"????"</span>,</span>
<span id="cb21-279"><a href="#cb21-279" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"????"</span>) <span class="sc">+</span></span>
<span id="cb21-280"><a href="#cb21-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb21-281"><a href="#cb21-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-282"><a href="#cb21-282" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-283"><a href="#cb21-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-284"><a href="#cb21-284" aria-hidden="true" tabindex="-1"></a>Take the code for the above graph and see if you can:</span>
<span id="cb21-285"><a href="#cb21-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-286"><a href="#cb21-286" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>work out what the <span class="in">`binwidth`</span> argument controls</span>
<span id="cb21-287"><a href="#cb21-287" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>try taking out <span class="in">`binwidth`</span>, exchange for <span class="in">`bins`</span> and see if you can work out what the <span class="in">`bins`</span> argument controls </span>
<span id="cb21-288"><a href="#cb21-288" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>work out what the <span class="in">`scale_x_continuous()`</span> function controls and why I've set it to this</span>
<span id="cb21-289"><a href="#cb21-289" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>give the figure a suitable title and x-axis label</span>
<span id="cb21-290"><a href="#cb21-290" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>change the colour to anything you'd like. Here is a website to help you: <span class="co">[</span><span class="ot">Colour picker</span><span class="co">](https://htmlcolorcodes.com/)</span></span>
<span id="cb21-291"><a href="#cb21-291" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>change the theme</span>
<span id="cb21-292"><a href="#cb21-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-293"><a href="#cb21-293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visulising distributions by catagorise (box plots)</span></span>
<span id="cb21-294"><a href="#cb21-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-295"><a href="#cb21-295" aria-hidden="true" tabindex="-1"></a>There are a number of ways that we could visualise how wellbeing (WEMEBS) differs across levels of deprivation (SIMD). Personaly, I like a box plot with a violin plot to demonstrate the distribution. </span>
<span id="cb21-296"><a href="#cb21-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-297"><a href="#cb21-297" aria-hidden="true" tabindex="-1"></a>The following code puts puts the continuous wellbeing variable on the x-axis and the five quintiles of deprevation on the y-axis. It then layer up two geometries: a <span class="in">`geom_violin()`</span> and a <span class="in">`geom_boxplot()`</span>. </span>
<span id="cb21-298"><a href="#cb21-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-299"><a href="#cb21-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-300"><a href="#cb21-300" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="sc">%&gt;%</span></span>
<span id="cb21-301"><a href="#cb21-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>wemwbs_score, <span class="at">y =</span> simd20_quintile))<span class="sc">+</span></span>
<span id="cb21-302"><a href="#cb21-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb21-303"><a href="#cb21-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb21-304"><a href="#cb21-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-305"><a href="#cb21-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-306"><a href="#cb21-306" aria-hidden="true" tabindex="-1"></a>It also creates one of the ugliest graph I've ever seen.</span>
<span id="cb21-307"><a href="#cb21-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-308"><a href="#cb21-308" aria-hidden="true" tabindex="-1"></a><span class="in">`r webexercises::hide("Click for ugly graph")`</span></span>
<span id="cb21-309"><a href="#cb21-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-310"><a href="#cb21-310" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/boxplot_ugly.png)</span></span>
<span id="cb21-311"><a href="#cb21-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-312"><a href="#cb21-312" aria-hidden="true" tabindex="-1"></a>Yuck! I'm sorry you had to see that.</span>
<span id="cb21-313"><a href="#cb21-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-314"><a href="#cb21-314" aria-hidden="true" tabindex="-1"></a><span class="in">`r unhide()`</span></span>
<span id="cb21-315"><a href="#cb21-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-316"><a href="#cb21-316" aria-hidden="true" tabindex="-1"></a>So, let's tart it up a bit.</span>
<span id="cb21-317"><a href="#cb21-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-318"><a href="#cb21-318" aria-hidden="true" tabindex="-1"></a>Much better:</span>
<span id="cb21-319"><a href="#cb21-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-320"><a href="#cb21-320" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/boxplot_nice.png)</span></span>
<span id="cb21-321"><a href="#cb21-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-322"><a href="#cb21-322" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb21-323"><a href="#cb21-323" aria-hidden="true" tabindex="-1"></a><span class="fu">### Code for plot</span></span>
<span id="cb21-324"><a href="#cb21-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-325"><a href="#cb21-325" aria-hidden="true" tabindex="-1"></a>Some new arguments in here. As before play around with them and see what they change. </span>
<span id="cb21-326"><a href="#cb21-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-327"><a href="#cb21-327" aria-hidden="true" tabindex="-1"></a>Note how I defined the colours in one expression and then just used the assigned <span class="in">`colours`</span> in the <span class="in">`ggplot()`</span>. This can save space and make things more efficient if you have multiple graphs with the same colour scheme.</span>
<span id="cb21-328"><a href="#cb21-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-329"><a href="#cb21-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-330"><a href="#cb21-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-331"><a href="#cb21-331" aria-hidden="true" tabindex="-1"></a>colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Most deprived (Q1)"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb21-332"><a href="#cb21-332" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Q2"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb21-333"><a href="#cb21-333" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Q3"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>,</span>
<span id="cb21-334"><a href="#cb21-334" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Q4"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>,</span>
<span id="cb21-335"><a href="#cb21-335" aria-hidden="true" tabindex="-1"></a>             <span class="st">"least deprived (Q5)"</span> <span class="ot">=</span> <span class="st">"#CC79A7"</span>)</span>
<span id="cb21-336"><a href="#cb21-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-337"><a href="#cb21-337" aria-hidden="true" tabindex="-1"></a>wemebs_simd_data <span class="sc">%&gt;%</span></span>
<span id="cb21-338"><a href="#cb21-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wemwbs_score, <span class="at">y =</span> simd20_quintile)) <span class="sc">+</span></span>
<span id="cb21-339"><a href="#cb21-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">fill =</span> simd20_quintile),</span>
<span id="cb21-340"><a href="#cb21-340" aria-hidden="true" tabindex="-1"></a>              <span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.9</span>, <span class="at">orientation =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb21-341"><a href="#cb21-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.4</span>, <span class="at">orientation =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb21-342"><a href="#cb21-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Most deprived (Q1)"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>, <span class="st">"least deprived (Q5)"</span>)) <span class="sc">+</span></span>
<span id="cb21-343"><a href="#cb21-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb21-344"><a href="#cb21-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colours)<span class="sc">+</span></span>
<span id="cb21-345"><a href="#cb21-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of WEMWBS Scores Across Deprivation Quintiles"</span>,</span>
<span id="cb21-346"><a href="#cb21-346" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"SIMD Quintile"</span>, </span>
<span id="cb21-347"><a href="#cb21-347" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"WEMWBS total"</span>) <span class="sc">+</span></span>
<span id="cb21-348"><a href="#cb21-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb21-349"><a href="#cb21-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb21-350"><a href="#cb21-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-351"><a href="#cb21-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-352"><a href="#cb21-352" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-353"><a href="#cb21-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-354"><a href="#cb21-354" aria-hidden="true" tabindex="-1"></a><span class="fu">## Take home exercises</span></span>
<span id="cb21-355"><a href="#cb21-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-356"><a href="#cb21-356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 1: Plot weight, hight and BMI catagories</span></span>
<span id="cb21-357"><a href="#cb21-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-358"><a href="#cb21-358" aria-hidden="true" tabindex="-1"></a>First exercise for this session is to adapt the blood pressure scatter plot above to create a scatter plot that demonstrates the catagories of BMI as they relate to height and weight. </span>
<span id="cb21-359"><a href="#cb21-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-360"><a href="#cb21-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-361"><a href="#cb21-361" aria-hidden="true" tabindex="-1"></a>For this exercise you will need to:</span>
<span id="cb21-362"><a href="#cb21-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-363"><a href="#cb21-363" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>create a date object that includes height and weight</span>
<span id="cb21-364"><a href="#cb21-364" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>calculate BMI (see session 1)</span>
<span id="cb21-365"><a href="#cb21-365" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>create the categorical variables associated with BMI (see session 2)</span>
<span id="cb21-366"><a href="#cb21-366" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>create a scatter of weight and height, with each point coloured by BMI catagories.</span>
<span id="cb21-367"><a href="#cb21-367" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>adapt the plot to make it look pretty</span>
<span id="cb21-368"><a href="#cb21-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-369"><a href="#cb21-369" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb21-370"><a href="#cb21-370" aria-hidden="true" tabindex="-1"></a><span class="fu">### Solution</span></span>
<span id="cb21-371"><a href="#cb21-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-372"><a href="#cb21-372" aria-hidden="true" tabindex="-1"></a>Lots of ways you could do this, here's how I tackled it:</span>
<span id="cb21-373"><a href="#cb21-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-374"><a href="#cb21-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-375"><a href="#cb21-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-376"><a href="#cb21-376" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb21-377"><a href="#cb21-377" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-378"><a href="#cb21-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-379"><a href="#cb21-379" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data</span></span>
<span id="cb21-380"><a href="#cb21-380" aria-hidden="true" tabindex="-1"></a>shes_2022_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"SHeS_2022_clean.csv"</span>)</span>
<span id="cb21-381"><a href="#cb21-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-382"><a href="#cb21-382" aria-hidden="true" tabindex="-1"></a><span class="co"># create continuious BMI variable  </span></span>
<span id="cb21-383"><a href="#cb21-383" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb21-384"><a href="#cb21-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, height_cm_self_adj, weight_kg_self_adj) <span class="sc">%&gt;%</span></span>
<span id="cb21-385"><a href="#cb21-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi =</span> weight_kg_self_adj <span class="sc">/</span> ((height_cm_self_adj <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb21-386"><a href="#cb21-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-387"><a href="#cb21-387" aria-hidden="true" tabindex="-1"></a><span class="co"># create BMI catagorical variables</span></span>
<span id="cb21-388"><a href="#cb21-388" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="ot">&lt;-</span> shes_BMI <span class="sc">%&gt;%</span></span>
<span id="cb21-389"><a href="#cb21-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi_band =</span> <span class="fu">case_when</span>(bmi <span class="sc">&lt;</span> <span class="fl">18.5</span> <span class="sc">~</span> <span class="st">"underweight"</span>,</span>
<span id="cb21-390"><a href="#cb21-390" aria-hidden="true" tabindex="-1"></a>                              bmi <span class="sc">&gt;=</span> <span class="fl">18.5</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;</span> <span class="dv">25</span>  <span class="sc">~</span> <span class="st">"healthy range"</span>,</span>
<span id="cb21-391"><a href="#cb21-391" aria-hidden="true" tabindex="-1"></a>                              bmi <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"overweight"</span>,</span>
<span id="cb21-392"><a href="#cb21-392" aria-hidden="true" tabindex="-1"></a>                              bmi <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"obesity"</span>,</span>
<span id="cb21-393"><a href="#cb21-393" aria-hidden="true" tabindex="-1"></a>                              bmi <span class="sc">&gt;=</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"severe obesity"</span>,</span>
<span id="cb21-394"><a href="#cb21-394" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>))</span>
<span id="cb21-395"><a href="#cb21-395" aria-hidden="true" tabindex="-1"></a><span class="co"># basic plot</span></span>
<span id="cb21-396"><a href="#cb21-396" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="sc">%&gt;%</span></span>
<span id="cb21-397"><a href="#cb21-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_kg_self_adj, </span>
<span id="cb21-398"><a href="#cb21-398" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> height_cm_self_adj, </span>
<span id="cb21-399"><a href="#cb21-399" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> bmi_band)) <span class="sc">+</span></span>
<span id="cb21-400"><a href="#cb21-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb21-401"><a href="#cb21-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-404"><a href="#cb21-404" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/bmi scatter plot basic.png)</span></span>
<span id="cb21-405"><a href="#cb21-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a><span class="co"># fancy plot</span></span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a>colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"underweight"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a>             <span class="st">"healthy range"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a>             <span class="st">"overweight"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>,</span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a>             <span class="st">"obesity"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>,</span>
<span id="cb21-412"><a href="#cb21-412" aria-hidden="true" tabindex="-1"></a>             <span class="st">"severe obesity"</span> <span class="ot">=</span> <span class="st">"#CC79A7"</span>)</span>
<span id="cb21-413"><a href="#cb21-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-414"><a href="#cb21-414" aria-hidden="true" tabindex="-1"></a><span class="co"># this reorders the catagories, to make the legend order correct</span></span>
<span id="cb21-415"><a href="#cb21-415" aria-hidden="true" tabindex="-1"></a><span class="co"># we'll be doing this more next week for logictic regression</span></span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="ot">&lt;-</span> shes_BMI <span class="sc">%&gt;%</span></span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bmi_band)) <span class="sc">%&gt;%</span> <span class="co"># this line removed the NAs</span></span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi_band =</span> <span class="fu">factor</span>(bmi_band,</span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"underweight"</span>, <span class="st">"healthy range"</span>, </span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"overweight"</span>, <span class="st">"obesity"</span>, </span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"severe obesity"</span>)))</span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-423"><a href="#cb21-423" aria-hidden="true" tabindex="-1"></a>shes_BMI <span class="sc">%&gt;%</span></span>
<span id="cb21-424"><a href="#cb21-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_kg_self_adj, </span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> height_cm_self_adj, </span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> bmi_band)) <span class="sc">+</span></span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> colours,</span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"BMI Category"</span>) <span class="sc">+</span></span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Weight (kg)"</span>, </span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Height (cm)"</span>, </span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Height and Weight by BMI Category"</span>,</span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Scottish Health Survey (2022)"</span>) <span class="sc">+</span></span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb21-435"><a href="#cb21-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb21-436"><a href="#cb21-436" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span>
<span id="cb21-440"><a href="#cb21-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-441"><a href="#cb21-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-442"><a href="#cb21-442" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/bmi scatter plot pretty.png)</span></span>
<span id="cb21-443"><a href="#cb21-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 2: Plot MAP by age catagories</span></span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a>For this exercise I'd like you to create a box an violin plot that shows Mean Arterial Pressure (MAP) broken down by age categories.</span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a>To create this plot you will need to:</span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>create a data object with the blood pressure data and the age variable</span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>calculate a MAP variable (see session 2)</span>
<span id="cb21-454"><a href="#cb21-454" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>create a categorical age variable (see session 2)</span>
<span id="cb21-455"><a href="#cb21-455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>create a basic box plot by adapting the above wellbeing/SIMD code</span>
<span id="cb21-456"><a href="#cb21-456" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>tart it up a bit to make it all pretty</span>
<span id="cb21-457"><a href="#cb21-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-458"><a href="#cb21-458" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb21-459"><a href="#cb21-459" aria-hidden="true" tabindex="-1"></a><span class="fu">### Solution</span></span>
<span id="cb21-460"><a href="#cb21-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-461"><a href="#cb21-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-462"><a href="#cb21-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-463"><a href="#cb21-463" aria-hidden="true" tabindex="-1"></a>shes_2022_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"SHeS_2022_clean.csv"</span>)</span>
<span id="cb21-464"><a href="#cb21-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-465"><a href="#cb21-465" aria-hidden="true" tabindex="-1"></a><span class="co"># this code selects the data</span></span>
<span id="cb21-466"><a href="#cb21-466" aria-hidden="true" tabindex="-1"></a>shes_bp_age <span class="ot">&lt;-</span> shes_2022_data <span class="sc">%&gt;%</span></span>
<span id="cb21-467"><a href="#cb21-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, age, bp_sys_omron_r3_mmhg, bp_sys_omron_r4_mmhg,</span>
<span id="cb21-468"><a href="#cb21-468" aria-hidden="true" tabindex="-1"></a>         bp_dia_omron_r3_mmhg, bp_dia_omron_r4_mmhg,</span>
<span id="cb21-469"><a href="#cb21-469" aria-hidden="true" tabindex="-1"></a>         bp_series_valid_code)</span>
<span id="cb21-470"><a href="#cb21-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-471"><a href="#cb21-471" aria-hidden="true" tabindex="-1"></a><span class="co"># this code filters to include only valid measurements</span></span>
<span id="cb21-472"><a href="#cb21-472" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="ot">&lt;-</span> shes_bp_age <span class="sc">%&gt;%</span></span>
<span id="cb21-473"><a href="#cb21-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bp_series_valid_code <span class="sc">==</span> <span class="st">"Valid blood pressure measurement"</span>)</span>
<span id="cb21-474"><a href="#cb21-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-475"><a href="#cb21-475" aria-hidden="true" tabindex="-1"></a><span class="co"># this code takes an average of the sys and dia readings</span></span>
<span id="cb21-476"><a href="#cb21-476" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="ot">&lt;-</span> shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb21-477"><a href="#cb21-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">systolic =</span> ((bp_sys_omron_r3_mmhg <span class="sc">+</span> bp_sys_omron_r4_mmhg)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb21-478"><a href="#cb21-478" aria-hidden="true" tabindex="-1"></a>         <span class="at">diastolic =</span> ((bp_dia_omron_r3_mmhg <span class="sc">+</span> bp_dia_omron_r4_mmhg)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb21-479"><a href="#cb21-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-480"><a href="#cb21-480" aria-hidden="true" tabindex="-1"></a><span class="co"># this code calculates Mean Arterial Pressure ()</span></span>
<span id="cb21-481"><a href="#cb21-481" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="ot">&lt;-</span> shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb21-482"><a href="#cb21-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">map =</span> (systolic <span class="sc">+</span> (<span class="dv">2</span> <span class="sc">*</span> diastolic)) <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb21-483"><a href="#cb21-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-484"><a href="#cb21-484" aria-hidden="true" tabindex="-1"></a><span class="co"># this code creates the age bands</span></span>
<span id="cb21-485"><a href="#cb21-485" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="ot">&lt;-</span> shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb21-486"><a href="#cb21-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_band =</span> <span class="fu">case_when</span>(age <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"18–29"</span>,</span>
<span id="cb21-487"><a href="#cb21-487" aria-hidden="true" tabindex="-1"></a>                              age <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">45</span>  <span class="sc">~</span> <span class="st">"30–44"</span>,</span>
<span id="cb21-488"><a href="#cb21-488" aria-hidden="true" tabindex="-1"></a>                              age <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">65</span>  <span class="sc">~</span> <span class="st">"45–64"</span>,</span>
<span id="cb21-489"><a href="#cb21-489" aria-hidden="true" tabindex="-1"></a>                              age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">"65+"</span>,</span>
<span id="cb21-490"><a href="#cb21-490" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>))</span>
<span id="cb21-491"><a href="#cb21-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-492"><a href="#cb21-492" aria-hidden="true" tabindex="-1"></a><span class="co"># basic box and violin plot code</span></span>
<span id="cb21-493"><a href="#cb21-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-494"><a href="#cb21-494" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb21-495"><a href="#cb21-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> map, <span class="at">y =</span> age_band)) <span class="sc">+</span></span>
<span id="cb21-496"><a href="#cb21-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb21-497"><a href="#cb21-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb21-498"><a href="#cb21-498" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-499"><a href="#cb21-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-500"><a href="#cb21-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-501"><a href="#cb21-501" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/map box plot basic.png)</span></span>
<span id="cb21-502"><a href="#cb21-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-503"><a href="#cb21-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-504"><a href="#cb21-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-505"><a href="#cb21-505" aria-hidden="true" tabindex="-1"></a><span class="co"># pretty graph code</span></span>
<span id="cb21-506"><a href="#cb21-506" aria-hidden="true" tabindex="-1"></a>colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"65+"</span> <span class="ot">=</span> <span class="st">"darkred"</span>,</span>
<span id="cb21-507"><a href="#cb21-507" aria-hidden="true" tabindex="-1"></a>             <span class="st">"45–64"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>,</span>
<span id="cb21-508"><a href="#cb21-508" aria-hidden="true" tabindex="-1"></a>             <span class="st">"30–44"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb21-509"><a href="#cb21-509" aria-hidden="true" tabindex="-1"></a>             <span class="st">"18–29"</span> <span class="ot">=</span> <span class="st">"salmon"</span>)</span>
<span id="cb21-510"><a href="#cb21-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-511"><a href="#cb21-511" aria-hidden="true" tabindex="-1"></a>shes_bp_age_valid <span class="sc">%&gt;%</span></span>
<span id="cb21-512"><a href="#cb21-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> map, <span class="at">y =</span> age_band)) <span class="sc">+</span></span>
<span id="cb21-513"><a href="#cb21-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">fill =</span> age_band),</span>
<span id="cb21-514"><a href="#cb21-514" aria-hidden="true" tabindex="-1"></a>              <span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">width =</span> <span class="fl">0.9</span>, <span class="at">orientation =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb21-515"><a href="#cb21-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.4</span>, <span class="at">orientation =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb21-516"><a href="#cb21-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">180</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb21-517"><a href="#cb21-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colours)<span class="sc">+</span></span>
<span id="cb21-518"><a href="#cb21-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of MAP Scores across Age"</span>,</span>
<span id="cb21-519"><a href="#cb21-519" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Age Bands"</span>, </span>
<span id="cb21-520"><a href="#cb21-520" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Mean Arterial Pressure (MAP)"</span>) <span class="sc">+</span></span>
<span id="cb21-521"><a href="#cb21-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb21-522"><a href="#cb21-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb21-523"><a href="#cb21-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-524"><a href="#cb21-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-525"><a href="#cb21-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-526"><a href="#cb21-526" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/map box plot pretty.png)</span></span>
<span id="cb21-527"><a href="#cb21-527" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-528"><a href="#cb21-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-529"><a href="#cb21-529" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bonus section: BBC News articles use ggplot </span></span>
<span id="cb21-530"><a href="#cb21-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-531"><a href="#cb21-531" aria-hidden="true" tabindex="-1"></a>Well done, you now have the skills to make publication quality figures. </span>
<span id="cb21-532"><a href="#cb21-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-533"><a href="#cb21-533" aria-hidden="true" tabindex="-1"></a>I’m a little obsessed with data visualisation. Much of my work looks at how the public understands big societal and scientific issues such as climate change, the cost of living, and pandemics. These issues require people to update their knowledge about complex topics, and a well-designed visualisation is often essential to make information clear and accessible.</span>
<span id="cb21-534"><a href="#cb21-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-535"><a href="#cb21-535" aria-hidden="true" tabindex="-1"></a>I’m a big fan of the work of the FT data journalist John Burn-Murdoch:</span>
<span id="cb21-536"><a href="#cb21-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-537"><a href="#cb21-537" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/JBM graphs.png)</span></span>
<span id="cb21-538"><a href="#cb21-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-539"><a href="#cb21-539" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">All made with R and ggplot</span><span class="co">](https://cloud.rstudio.com/authors/john-burn-murdoch/)</span></span>
<span id="cb21-540"><a href="#cb21-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-541"><a href="#cb21-541" aria-hidden="true" tabindex="-1"></a>And he, and the FT, are not the only journalists using <span class="in">`ggplot()`</span>. The BBC adopted ggplot a few years ago, here is their *cookbook* where they outline their process: <span class="co">[</span><span class="ot">BBC Visual and Data Journalism cookbook for R graphics</span><span class="co">](https://bbc.github.io/rcookbook/)</span></span>
<span id="cb21-542"><a href="#cb21-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-543"><a href="#cb21-543" aria-hidden="true" tabindex="-1"></a>This is so comprehensive that it's possible to **read a BBC article**, **see a graph**, and the go out **and recreate**. </span>
<span id="cb21-544"><a href="#cb21-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-545"><a href="#cb21-545" aria-hidden="true" tabindex="-1"></a>So that's what I decided to do!</span>
<span id="cb21-546"><a href="#cb21-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-547"><a href="#cb21-547" aria-hidden="true" tabindex="-1"></a>Here is the article: <span class="co">[</span><span class="ot">Three years left to limit warming to 1.5C, leading scientists warn</span><span class="co">](https://www.bbc.co.uk/news/articles/cn4l927dj5zo)</span>  </span>
<span id="cb21-548"><a href="#cb21-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-549"><a href="#cb21-549" aria-hidden="true" tabindex="-1"></a>Here is their plot:</span>
<span id="cb21-550"><a href="#cb21-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-551"><a href="#cb21-551" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/BBC plot original.png)</span></span>
<span id="cb21-552"><a href="#cb21-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-553"><a href="#cb21-553" aria-hidden="true" tabindex="-1"></a>And here is my attempt at recreating it:</span>
<span id="cb21-554"><a href="#cb21-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-555"><a href="#cb21-555" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/BBC plot my version.png)</span></span>
<span id="cb21-556"><a href="#cb21-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-557"><a href="#cb21-557" aria-hidden="true" tabindex="-1"></a>They had the up-to-date data that pushed the line over 1.5C (hense news!) and there were a few bits I couldn't recreate. But still, pretty close, right! I'd be great at creating misinformation if I wanted to!</span>
<span id="cb21-558"><a href="#cb21-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-559"><a href="#cb21-559" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb21-560"><a href="#cb21-560" aria-hidden="true" tabindex="-1"></a><span class="fu">### Code for plot</span></span>
<span id="cb21-561"><a href="#cb21-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-562"><a href="#cb21-562" aria-hidden="true" tabindex="-1"></a>Here is the code, though it wont run unless you have the associated datasets. </span>
<span id="cb21-563"><a href="#cb21-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-564"><a href="#cb21-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb21-565"><a href="#cb21-565" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-566"><a href="#cb21-566" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbplot)</span>
<span id="cb21-567"><a href="#cb21-567" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb21-568"><a href="#cb21-568" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb21-569"><a href="#cb21-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-570"><a href="#cb21-570" aria-hidden="true" tabindex="-1"></a>annual <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"annual_averages.csv"</span>)</span>
<span id="cb21-571"><a href="#cb21-571" aria-hidden="true" tabindex="-1"></a>decadal <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"decadal_averages.csv"</span>)</span>
<span id="cb21-572"><a href="#cb21-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-573"><a href="#cb21-573" aria-hidden="true" tabindex="-1"></a>subtitle_text <span class="ot">&lt;-</span> <span class="st">"Global air temperature compared with pre-industraial &lt;br&gt; (1850-1900) levels &lt;span style='color:salmon;'&gt;yearly average&lt;/span&gt; and &lt;span style='color:darkred;'&gt;10-year average&lt;/span&gt;."</span></span>
<span id="cb21-574"><a href="#cb21-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-575"><a href="#cb21-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-576"><a href="#cb21-576" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-577"><a href="#cb21-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> annual, </span>
<span id="cb21-578"><a href="#cb21-578" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>GMST), </span>
<span id="cb21-579"><a href="#cb21-579" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"salmon"</span>, </span>
<span id="cb21-580"><a href="#cb21-580" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.15</span>)<span class="sc">+</span></span>
<span id="cb21-581"><a href="#cb21-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> decadal, </span>
<span id="cb21-582"><a href="#cb21-582" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>GMST), </span>
<span id="cb21-583"><a href="#cb21-583" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"darkred"</span>,</span>
<span id="cb21-584"><a href="#cb21-584" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.15</span>)<span class="sc">+</span></span>
<span id="cb21-585"><a href="#cb21-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"How the planet's temperature has risen"</span>,</span>
<span id="cb21-586"><a href="#cb21-586" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> subtitle_text,</span>
<span id="cb21-587"><a href="#cb21-587" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"GDP per Capita (log scale recommended)"</span>,</span>
<span id="cb21-588"><a href="#cb21-588" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Life Expectancy (Years)"</span>) <span class="sc">+</span></span>
<span id="cb21-589"><a href="#cb21-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>),</span>
<span id="cb21-590"><a href="#cb21-590" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>),</span>
<span id="cb21-591"><a href="#cb21-591" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"-0.5°C"</span>, </span>
<span id="cb21-592"><a href="#cb21-592" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"pre-</span><span class="sc">\n</span><span class="st">industrial</span><span class="sc">\n</span><span class="st"> average"</span>, </span>
<span id="cb21-593"><a href="#cb21-593" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"+0.5°C"</span>,</span>
<span id="cb21-594"><a href="#cb21-594" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"+1.0°C"</span>,</span>
<span id="cb21-595"><a href="#cb21-595" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"+1.5°C"</span>))<span class="sc">+</span> </span>
<span id="cb21-596"><a href="#cb21-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bbc_style</span>()<span class="sc">+</span></span>
<span id="cb21-597"><a href="#cb21-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">28</span>),</span>
<span id="cb21-598"><a href="#cb21-598" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">22</span>),</span>
<span id="cb21-599"><a href="#cb21-599" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>),</span>
<span id="cb21-600"><a href="#cb21-600" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>))</span>
<span id="cb21-601"><a href="#cb21-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-602"><a href="#cb21-602" aria-hidden="true" tabindex="-1"></a><span class="fu">finalise_plot</span>(<span class="at">plot_name =</span> plot2,</span>
<span id="cb21-603"><a href="#cb21-603" aria-hidden="true" tabindex="-1"></a>              <span class="at">source =</span> <span class="st">"Source: Forster et al.(2025), Earth System Science Data"</span>,</span>
<span id="cb21-604"><a href="#cb21-604" aria-hidden="true" tabindex="-1"></a>              <span class="at">save_filepath =</span> <span class="st">"three years left.png"</span>,</span>
<span id="cb21-605"><a href="#cb21-605" aria-hidden="true" tabindex="-1"></a>              <span class="at">width_pixels =</span> <span class="dv">640</span>,</span>
<span id="cb21-606"><a href="#cb21-606" aria-hidden="true" tabindex="-1"></a>              <span class="at">height_pixels =</span> <span class="dv">450</span>)</span>
<span id="cb21-607"><a href="#cb21-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-608"><a href="#cb21-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-609"><a href="#cb21-609" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-610"><a href="#cb21-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-611"><a href="#cb21-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-612"><a href="#cb21-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-613"><a href="#cb21-613" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>